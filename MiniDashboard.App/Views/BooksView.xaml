<UserControl x:Class="MiniDashboard.App.Views.BooksView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:MiniDashboard.App.Converters">
    <UserControl.Resources>
		<BooleanToVisibilityConverter x:Key="BoolToVis" />
        <conv:ObjectCollectionToCsvConverter x:Key="ObjToCsv" />
    </UserControl.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<StackPanel Orientation="Horizontal" Margin="10">
            <Button Content="Create Book" Margin="5 0" Padding="10 2" Command="{Binding OpenCreateDialogCommand}" />
			<Button Content="Refresh" Margin="5 0" Padding="10 2" Command="{Binding LoadBooksCommand}" />
		</StackPanel>

		<DataGrid Grid.Row="1"
				ItemsSource="{Binding Books}"
				AutoGenerateColumns="False"
				IsReadOnly="True">
            <DataGrid.Columns>
				<DataGridTextColumn Header="Id" Binding="{Binding BookId}" Width="*" />
				<DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="50*" />
                <DataGridTextColumn Header="SubTitle" Binding="{Binding SubTitle}" Width="20*" />
                <DataGridTextColumn Header="#" Binding="{Binding SeriesNumber}" Width="10*" />
                <DataGridTextColumn Header="Series" Binding="{Binding Series}" Width="40*" />
                <DataGridTextColumn Header="Authors" Binding="{Binding Authors, Converter={StaticResource ObjToCsv}, ConverterParameter=Name}" Width="50*" />
                <DataGridTextColumn Header="Genres" Binding="{Binding Genres, Converter={StaticResource ObjToCsv}, ConverterParameter=Name}" Width="40*" />

                <DataGridTemplateColumn Header="Edit" Width="10*">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<Button Content="Edit"
									Padding="6 2"
									Command="{Binding DataContext.OpenEditDialogCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
									CommandParameter="{Binding}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
		</DataGrid>


		<!--Create/Edit Modal-->
		<Border Background="#80000000"
						Visibility="{Binding IsDialogOpen, Converter={StaticResource BoolToVis}}"
						Grid.RowSpan="2"
						Padding="20"
						CornerRadius="4">
			<Grid HorizontalAlignment="Center"
						VerticalAlignment="Center"
						Width="400"
						Background="White">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

                <TextBlock Text="{Binding ModalHeader}"
									 FontSize="18"
									 Margin="10" />

				<StackPanel Grid.Row="1" Margin="10">
					<TextBlock Text="Title"/>
					<TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" />
				</StackPanel>
				<StackPanel Grid.Row="2" Margin="10">
					<TextBlock Text="SubTitle"/>
					<TextBox Text="{Binding SubTitle, UpdateSourceTrigger=PropertyChanged}" />
				</StackPanel>
				<StackPanel Grid.Row="3" Margin="10">
					<TextBlock Text="Series"/>
					<TextBox Text="{Binding Series, UpdateSourceTrigger=PropertyChanged}"  />
				</StackPanel>
				<StackPanel Grid.Row="4" Margin="10">
					<TextBlock Text="Series Number"/>
					<TextBox Text="{Binding SeriesNumber, UpdateSourceTrigger=PropertyChanged}" />
				</StackPanel>
				<StackPanel Grid.Row="5" Margin="10">
					<TextBlock Text="Authors"/>
					<TextBox Text="{Binding Authors, UpdateSourceTrigger=PropertyChanged}" />
				</StackPanel>
				<StackPanel Grid.Row="6" Margin="10">
					<TextBlock Text="Genres"/>
					<TextBox Text="{Binding Genres, UpdateSourceTrigger=PropertyChanged}" />
				</StackPanel>
				<StackPanel Grid.Row="7"
										Margin="20"
										Orientation="Horizontal"
										HorizontalAlignment="Right">
					<Button Content="Cancel"
									Margin="10"
									Command="{Binding CancelDialogCommand}" />
                    <Button Content="Save"
                            Margin="10"
                            Command="{Binding SaveBookCommand}" />
                </StackPanel>
			</Grid>
		</Border>
	</Grid>
</UserControl>